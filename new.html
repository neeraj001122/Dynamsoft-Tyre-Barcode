<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <meta
      name="description"
      content="Quickly read barcodes with Dynamsoft Barcode Reader from a live camera stream."
    />
    <meta name="keywords" content="barcode, camera" />
    <link
      rel="canonical"
      href="https://demo.dynamsoft.com/Samples/DBR/JS/foundational-api-samples/hello-world/hello-world.html"
    />
    <title>
      Dynamsoft Barcode Reader Sample - Hello World (Decode via Camera)
    </title>
  </head>

  <body>
    <h1>Hello World (Decode via Camera)</h1>
    <div>
      <label for="templateSelect">Select Template: </label>
      <select id="templateSelect" style="margin: 10px 0">
        <option value="ReadBarcodes_SpeedFirst">Speed First</option>
        <option value="ReadBarcodes_Balance" selected>Balance</option>
        <option value="ReadDistantBarcodes">Distant Barcodes</option>
      </select>
      <button onclick="updateTemplate()">Apply Template</button>
    </div>
    <div>
      <label for="zoomFactor">Zoom Factor (1-5): </label>
      <input
        type="number"
        id="zoomFactor"
        min="1"
        max="5"
        value="1"
        step="0.5"
        style="margin: 10px 0"
      />
      <button onclick="updateZoom()">Apply Zoom</button>
    </div>
    <div id="camera-view-container" style="width: 100%; height: 80vh"></div>
    Results:<br />
    <div
      id="results"
      style="width: 100%; height: 10vh; overflow: auto; white-space: pre-wrap"
    ></div>
    <script src="https://cdn.jsdelivr.net/npm/dynamsoft-barcode-reader-bundle@11.0.6000/dist/dbr.bundle.js"></script>
    <!-- If the network is unstable or you prefer to self-host the SDK, uncomment the line below to load it locally -->
    <!-- <script src="../../../dist/dbr.bundle.js"></script> -->

    <script>
      /** LICENSE ALERT - README
       * To use the library, you need to first specify a license key using the API "initLicense()" as shown below.
       */

      Dynamsoft.License.LicenseManager.initLicense(
        "DLS2eyJoYW5kc2hha2VDb2RlIjoiMTAxODM2MjY5LU1UQXhPRE0yTWpZNUxYZGxZaTFVY21saGJGQnliMm8iLCJtYWluU2VydmVyVVJMIjoiaHR0cHM6Ly9tbHRzLmR5bmFtc29mdC5jb20iLCJvcmdhbml6YXRpb25JRCI6IjEwMTgzNjI2OSIsInN0YW5kYnlTZXJ2ZXJVUkwiOiJodHRwczovL3NsdHMuZHluYW1zb2Z0LmNvbSIsImNoZWNrQ29kZSI6MTY5NDMyODczNX0="
      );

      /**
       * You can visit https://www.dynamsoft.com/customer/license/trialLicense?utm_source=samples&product=dbr&package=js to get your own trial license good for 30 days.
       * Note that if you downloaded this sample from Dynamsoft while logged in, the above license key may already be your own 30-day trial license.
       * For more information, see https://www.dynamsoft.com/barcode-reader/docs/web/programming/javascript/user-guide/index.html?ver=11.0.6000&cVer=true#specify-the-license&utm_source=samples or contact support@dynamsoft.com.
       * LICENSE ALERT - THE END
       */

      // Optional. Used to load wasm resources in advance, reducing latency between video playing and barcode decoding.
      Dynamsoft.Core.CoreModule.loadWasm();
      // Defined globally for easy debugging.
      let cameraEnhancer, cvRouter;

      (async () => {
        try {
          // Create a `CameraEnhancer` instance for camera control and a `CameraView` instance for UI control.
          const cameraView = await Dynamsoft.DCE.CameraView.createInstance();
          cameraEnhancer = await Dynamsoft.DCE.CameraEnhancer.createInstance(
            cameraView
          );
          // Get default UI and append it to DOM.
          document
            .querySelector("#camera-view-container")
            .append(cameraView.getUIElement());

          // Create a `CaptureVisionRouter` instance and set `CameraEnhancer` instance as its image source.
          cvRouter = await Dynamsoft.CVR.CaptureVisionRouter.createInstance();
          cvRouter.setInput(cameraEnhancer);

          // Obtain current runtime settings of `router` instance. Here we use `ReadSingleBarcode` as an example. You can change it to your own template name or the name of other preset template.
          let settings = await cvRouter.getSimplifiedSettings(
            "ReadBarcodes_Balance"
          );
          // Specify the barcode formats by enumeration values.
          // Use "|" to enable multiple barcode formats at one time.
          settings.barcodeSettings.barcodeFormatIds =
            Dynamsoft.DBR.EnumBarcodeFormat.BF_CODE_39;
          // Update the settings to a specific template.
          await cvRouter.updateSettings("ReadBarcodes_Balance", settings);

          await cameraEnhancer.setResolution({ width: 1920, height: 1080 });

          // Define a callback for results.
          cvRouter.addResultReceiver({
            onDecodedBarcodesReceived: (result) => {
              if (!result.barcodeResultItems.length) return;

              const resultsContainer = document.querySelector("#results");
              resultsContainer.textContent = "";
              console.log(result);
              for (let item of result.barcodeResultItems) {
                resultsContainer.textContent += `${item.formatString}: ${item.text}\n\n`;
              }
            },
          });

          // Filter out unchecked and duplicate results.
          const filter = new Dynamsoft.Utility.MultiFrameResultCrossFilter();
          // Filter out unchecked barcodes.
          filter.enableResultCrossVerification("barcode", true);
          // Filter out duplicate barcodes within 3 seconds.
          filter.enableResultDeduplication("barcode", true);
          await cvRouter.addResultFilter(filter);

          // Open camera and start scanning barcode.
          await cameraEnhancer.open();
          cameraView.setScanLaserVisible(true);
          await cvRouter.startCapturing("ReadBarcodes_Balance");
        } catch (ex) {
          let errMsg = ex.message || ex;
          console.error(errMsg);
          alert(errMsg);
        }
      })();

      // Add this function after the existing async IIFE
      async function updateZoom() {
        const zoomInput = document.getElementById("zoomFactor");
        const value = parseFloat(zoomInput.value);

        if (value >= 1 && value <= 6) {
          try {
            await cameraEnhancer.setZoom({
              factor: value,
            });
          } catch (error) {
            console.error("Failed to set zoom:", error);
            alert("Failed to set zoom. Please try again.");
          }
        } else {
          alert("Please enter a value between 1 and 5");
          zoomInput.value = 1;
        }
      }

      async function updateTemplate() {

       await cvRouter.stopCapturing();


        const templateSelect = document.getElementById("templateSelect");
        const selectedTemplate = templateSelect.value;

        try {
          // Obtain current runtime settings of `router` instance.
          let settings = await cvRouter.getSimplifiedSettings(selectedTemplate);

          // Specify the barcode formats by enumeration values.
          // Use "|" to enable multiple barcode formats at one time.
          settings.barcodeSettings.barcodeFormatIds =
            Dynamsoft.DBR.EnumBarcodeFormat.BF_CODE_39;

          // Update the settings to the selected template.
          await cvRouter.updateSettings(selectedTemplate, settings);

          // Restart capturing with the new template.
          await cvRouter.startCapturing(selectedTemplate);
          alert(`template has been changed to ${selectedTemplate}`)
        } catch (error) {
          console.error("Failed to update template:", error);
          alert("Failed to update template. Please try again.");
        }
      }
    </script>
  </body>
</html>
